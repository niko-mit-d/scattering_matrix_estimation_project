% Script to check if calculated constraints and derivatives
% are correct for dim_S = {2,3,4,5}
clear all; clc;

%% Copy Maple output here
x = [0.2499109628e0 0.3475034102e0 0.1766288344e1 0.2026591600e0 0.8823971507e-2 0.1689233885e1 0.1209628080e1 0.1722913437e1 0.7786143432e0 0.5108327385e0 0.2750667362e0 0.1752850289e1 0.1224136121e1 0.9447763000e-1 0.1698714160e1 0.5091763968e0 0.5199090505e-2 0.2999657008e0];
hs_maple = [-0.1448442502e0 -0.556660264e0 0.33679552e-1 0.9490693848e0 -0.1243673892e1 -0.1693515069e1];
dhsdx_maple = [0 -1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0; 0 0 -1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0; 0 0 0 0 0 -1 0 1 0 0 0 0 0 0 0 0 0 0; 0 0 0 0 0 0 0 0 0 0 -1 0 1 0 0 0 0 0; 0 0 0 0 0 0 0 0 0 0 0 -1 0 0 0 1 0 0; 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 1 0;];

hu_maple = [0.7712084555e1 0.6666295293e1 0.3063604087e1 0.8287724778e1 0.2708955282e1 0.6387138154e1];
dhudx_maple = [0.4998219256e0 0.6950068204e0 0.3532576688e1 0 0 0 0 0 0 0.1021665477e1 0.5501334724e0 0.3505700578e1 0 0 0 0 0 0; 0.2026591600e0 0.8823971507e-2 0.1689233885e1 0.2499109628e0 0.3475034102e0 0.1766288344e1 0 0 0 0.1224136121e1 0.9447763000e-1 0.1698714160e1 0.5108327385e0 0.2750667362e0 0.1752850289e1 0 0 0; 0.1209628080e1 0.1722913437e1 0.7786143432e0 0 0 0 0.2499109628e0 0.3475034102e0 0.1766288344e1 0.5091763968e0 0.5199090505e-2 0.2999657008e0 0 0 0 0.5108327385e0 0.2750667362e0 0.1752850289e1; 0 0 0 0.4053183200e0 0.1764794301e-1 0.3378467770e1 0 0 0 0 0 0 0.2448272242e1 0.1889552600e0 0.3397428320e1 0 0 0; 0 0 0 0.1209628080e1 0.1722913437e1 0.7786143432e0 0.2026591600e0 0.8823971507e-2 0.1689233885e1 0 0 0 0.5091763968e0 0.5199090505e-2 0.2999657008e0 0.1224136121e1 0.9447763000e-1 0.1698714160e1; 0 0 0 0 0 0 0.2419256160e1 0.3445826874e1 0.1557228686e1 0 0 0 0 0 0 0.1018352794e1 0.1039818101e-1 0.5999314016e0;];

%% Test
run run_parmeters.m
x = x';
hs_maple = hs_maple';
hu_maple = hu_maple';
[hs, dhsdx] = constraint_symmetry(x, param);
[hu, dhudx] = constraint_unitary(x, param);

if (all(isapprox(dhsdx, dhsdx_maple,"loose"),"all") && ...
        all(isapprox(hs, hs_maple,"loose"),"all") && ...
        all(isapprox(dhudx, dhudx_maple,"loose"),"all") && ...
        all(isapprox(hu, hu_maple,"loose"),"all"))
    fprintf("Maple and matlab implementations match for dim_S=%d!\n", param.sys.dim_S);
else
    fprintf("Maple and Matlab mismatch\n");
end

